@layer components {
  /* Base taskbar styles that apply to all themes, including external ones */
  .taskbar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    /* Base styles using CSS variables */
    background: var(--taskbar-bg, rgba(240, 240, 240, 0.8));
    color: var(--text-primary, #000000);
    border-top: 1px solid var(--wm-border-color, rgba(0, 0, 0, 0.1));
    box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.1);
    padding: 0.25rem;
    backdrop-filter: blur(4px);
    
    /* BeOS specific styling */
    .theme-beos & {
      @apply border-t border-gray-400 p-1;
      color: var(--text-primary);
      box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* Modern theme styles (Light and Dark) */
    .theme-light &, .theme-dark & {
      @apply backdrop-blur-lg border-t border-border p-1;
      box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* Light theme specific text color */
    .theme-light & {
      color: var(--text-primary);
    }
    
    /* Dark theme specific text color */
    .theme-dark & {
      color: var(--foreground);
    }
    
    /* macOS Dock-style taskbar */
    .theme-macos & {
      width: var(--dock-width, 600px);
      height: var(--dock-height, 64px);
      margin: 0 auto;
      border-radius: var(--dock-border-radius, 16px) var(--dock-border-radius, 16px) 0 0;
      backdrop-filter: blur(12px);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
      border-width: 1px;
      border-bottom: none;
      background-color: rgba(255, 255, 255, 0.75);
      padding: 0.5rem 1rem;
    }
    
    /* Windows specific colors */
    .theme-windows & {
      backdrop-filter: blur(4px); /* Less blur than macOS */
      border-color: hsla(210, 100%, 35%, 1);
      color: #ffffff;
    }
    
    /* Fluxbox specific styling */
    .theme-fluxbox & {
      @apply border-t p-1;
      border-color: hsla(0, 0%, 20%, 1);
      color: #eeeeee;
      box-shadow: 0 -1px 6px rgba(0, 0, 0, 0.2);
    }
  }

  /* Base taskbar item styles - works for all themes */
  .taskbar-item {
    @apply cursor-pointer mx-1 flex items-center;
    min-width: 110px;
    height: 36px;
    padding: 0.375rem 0.75rem;
    color: var(--text-primary, #000000);
    border: 1px solid var(--wm-border-color, transparent);
    background-color: var(--taskbar-item-bg, transparent);
    transition: all 150ms ease;
    border-radius: var(--taskbar-item-radius, 0.25rem);
    gap: 0.5rem;
    
    /* BeOS style */
    .theme-beos & {
      @apply px-3 py-1.5 text-xs font-bold bg-gray-100 hover:bg-white border border-gray-300;
      color: var(--text-primary);
      min-width: 100px;
      height: 36px;
    }
    
    /* Modern styles (Light, Dark) */
    .theme-light &, .theme-dark & {
      @apply px-3 py-1.5 rounded-md text-sm border border-transparent hover:bg-accent hover:text-accent-foreground gap-2 transition-all duration-150;
      min-width: 120px;
      height: 36px;
      backdrop-filter: blur(8px);
    }
    
    /* macOS Dock-style item */
    .theme-macos & {
      @apply px-3 py-1.5 rounded-xl border border-white/20 gap-2 transition-all duration-200;
      flex-direction: column;
      justify-content: center;
      height: 100%;
      min-width: 64px;
      max-width: 80px;
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
    }
    
    /* Light theme specific color */
    .theme-light & {
      color: var(--text-primary);
    }
    
    /* Dark theme specific color */
    .theme-dark & {
      color: var(--foreground);
    }
    
    /* Windows style */
    .theme-windows & {
      @apply px-3 py-1.5 text-sm border border-transparent hover:bg-white/20 gap-2 transition-all duration-150;
      color: #ffffff;
      min-width: 120px;
      height: 36px;
    }
    
    /* Fluxbox style */
    .theme-fluxbox & {
      @apply px-3 py-1.5 text-sm border border-gray-700 hover:bg-gray-600 gap-2 transition-all duration-150;
      color: #eeeeee;
      min-width: 120px;
      height: 36px;
      background-color: #444444;
    }
  }
  
  /* Base hover state - works for all themes */
  .taskbar-item:hover {
    background-color: var(--taskbar-item-hover-bg, rgba(255, 255, 255, 0.2));
    transform: scale(1.05);
    
    /* Shared hover effect for modern themes */
    .theme-light &, .theme-dark & {
      @apply shadow-sm scale-105;
    }
    
    /* macOS specific hover with larger scale for dock effect */
    .theme-macos & {
      @apply shadow-lg scale-110 bg-white/30;
    }
    
    /* Fluxbox specific hover */
    .theme-fluxbox & {
      @apply scale-100;
    }
  }
  
  /* Base active state - works for all themes */
  .taskbar-item:active {
    transform: scale(0.95);
    
    /* Shared active effect for modern themes */
    .theme-light &, .theme-dark & {
      @apply scale-95;
    }
    
    /* macOS active effect */
    .theme-macos & {
      @apply scale-90;
    }
    
    /* Fluxbox specific active state */
    .theme-fluxbox & {
      @apply scale-95 bg-gray-700;
    }
  }
  
  /* Base active class - works for all themes */
  .taskbar-item.active {
    background-color: var(--taskbar-item-active-bg, rgba(255, 255, 255, 0.2)) !important;
    color: var(--text-primary, #000000) !important;
    border-color: var(--wm-border-color, rgba(0, 0, 0, 0.1));
    opacity: 1 !important;
    
    /* BeOS active state */
    .theme-beos & {
      @apply bg-white;
    }
    
    /* Light active state */
    .theme-light & {
      background-color: hsl(220 14.3% 95.9%) !important;
      color: hsl(220.9 39.3% 11%) !important;
      @apply border-border;
      opacity: 1 !important;
    }
    
    /* Dark active state */
    .theme-dark & {
      background-color: hsl(215 27.9% 16.9%) !important;
      color: hsl(210 20% 98%) !important;
      @apply border-border;
      opacity: 1 !important;
    }
    
    /* macOS active state */
    .theme-macos & {
      background-color: rgba(255, 255, 255, 0.5) !important;
      color: #000000 !important;
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      @apply scale-105;
      opacity: 1 !important;
    }
    
    /* Windows active state */
    .theme-windows & {
      background-color: rgba(255, 255, 255, 0.2) !important;
      color: #ffffff !important;
      @apply border-white/20;
      opacity: 1 !important;
    }
    
    /* Fluxbox active state */
    .theme-fluxbox & {
      background-color: #555555 !important;
      color: #ffffff !important;
      @apply border-gray-600;
      opacity: 1 !important;
    }
  }
  
  /* Base taskbar icon - works for all themes */
  .taskbar-item-icon {
    width: 1.25rem;
    height: 1.25rem;
    opacity: 0.9;
    
    /* BeOS icon */
    .theme-beos & {
      @apply w-4 h-4 mr-1;
    }
    
    /* Modern icon styles */
    .theme-light &, .theme-dark & {
      @apply w-5 h-5 text-muted-foreground;
    }
    
    /* macOS icon - larger for the dock */
    .theme-macos & {
      width: var(--dock-icon-size, 32px);
      height: var(--dock-icon-size, 32px);
      @apply opacity-90;
    }
    
    /* Windows icons */
    .theme-windows & {
      @apply w-5 h-5 opacity-80;
    }
    
    /* Fluxbox icon */
    .theme-fluxbox & {
      @apply w-4 h-4 mr-1 opacity-80;
    }
  }
  
  /* Taskbar item label - for macOS dock */
  .taskbar-item-label {
    /* macOS specific styling */
    .theme-macos & {
      font-size: 0.75rem;
      margin-top: var(--dock-item-gap, 8px);
      color: var(--window-header-text, #333333);
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
      max-width: 100%;
    }
  }
  
  /* Base separator style - works for all themes */
  .taskbar-separator {
    width: 1px;
    height: 1.5rem;
    background-color: var(--wm-border-color, rgba(0, 0, 0, 0.1));
    margin: 0 0.5rem;
    opacity: 0.5;
    
    /* BeOS separator */
    .theme-beos & {
      @apply w-px h-4 bg-gray-300 mx-1;
    }
    
    /* Modern separators */
    .theme-light &, .theme-dark & {
      @apply w-px h-6 bg-border mx-2 opacity-50;
    }
    
    /* macOS separator */
    .theme-macos & {
      @apply w-px h-8 bg-black/10 mx-3;
    }
    
    /* Windows separator */
    .theme-windows & {
      @apply w-px h-6 bg-white/20 mx-2;
    }
    
    /* Fluxbox separator */
    .theme-fluxbox & {
      @apply w-px h-5 bg-gray-600 mx-1;
    }
  }
  
  /* Base start button style - works for all themes */
  .taskbar-start {
    font-weight: 500;
    padding: 0 1rem;
    display: flex;
    align-items: center;
    margin-right: auto;
    margin-left: 0.25rem;
    height: 36px;
    background-color: var(--accent-primary, #7c3aed);
    color: white;
    border-radius: 0.25rem;
    transition: all 200ms ease;
    
    /* BeOS start button */
    .theme-beos & {
      @apply bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-none px-2 flex items-center mr-auto;
      height: 36px;
    }
    
    /* Common modern start button properties */
    .theme-light &, .theme-dark &, .theme-windows &, .theme-fluxbox & {
      @apply font-medium px-4 flex items-center mr-auto ml-1 transition-all duration-200;
      height: 36px;
      opacity: 1 !important;
    }
    
    /* macOS start button - circular */
    .theme-macos & {
      background-color: var(--accent-primary, #007aff) !important;
      color: white !important;
      @apply rounded-full flex items-center justify-center;
      width: 42px;
      height: 42px;
      min-width: 42px;
      padding: 0;
      margin: 0 0.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      display: none; /* Hide the start button in macOS as it doesn't have one */
    }
    
    /* Light theme start button */
    .theme-light & {
      background-color: hsl(262.1 83.3% 57.8%) !important;
      color: hsl(210 20% 98%) !important;
      @apply rounded-md;
    }
    
    /* Dark theme start button */
    .theme-dark & {
      background-color: hsl(263.4 70% 50.4%) !important;
      color: hsl(210 20% 98%) !important;
      @apply rounded-md;
    }
    
    /* Windows start button */
    .theme-windows & {
      background-color: rgba(255, 255, 255, 0.2) !important;
      color: white !important;
    }
    
    /* Fluxbox start button */
    .theme-fluxbox & {
      background-color: #555555 !important;
      color: #eeeeee !important;
      @apply rounded-sm border border-gray-600;
    }
  }
  
  /* Base start button hover - works for all themes */
  .taskbar-start:hover {
    filter: brightness(1.1);
    
    /* Light theme start button hover */
    .theme-light & {
      background-color: hsl(262.1 83.3% 52%) !important;
    }
    
    /* Dark theme start button hover */
    .theme-dark & {
      background-color: hsl(263.4 70% 45%) !important;
    }
    
    /* macOS start button hover */
    .theme-macos & {
      @apply scale-110;
      background-color: var(--accent-primary, #007aff) !important;
    }
    
    /* Windows start button hover */
    .theme-windows & {
      background-color: rgba(255, 255, 255, 0.3) !important;
    }
    
    /* Fluxbox start button hover */
    .theme-fluxbox & {
      background-color: #666666 !important;
    }
  }
}
