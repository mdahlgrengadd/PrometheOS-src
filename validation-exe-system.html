<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ .exe Folder System Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 30px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            margin: 25px 0;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #ff5252, #d32f2f);
        }
        
        .primary-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
        }
        
        .primary-btn:hover {
            background: linear-gradient(45deg, #45a049, #3e8e41);
        }
        
        .secondary-btn {
            background: linear-gradient(45deg, #2196f3, #1976d2);
        }
        
        .secondary-btn:hover {
            background: linear-gradient(45deg, #1976d2, #1565c0);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .success {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.9);
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #4caf50; }
        .status-error { background: #f44336; }
        .status-warning { background: #ff9800; }
        .status-pending { background: #9e9e9e; }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .checklist li:last-child {
            border-bottom: none;
        }
        
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }
        
        .info-box {
            background: rgba(33, 150, 243, 0.1);
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .flow-diagram {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            text-align: center;
        }
        
        .arrow {
            color: #ffd700;
            font-size: 18px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>üéØ .exe Folder System Validation</h1>
    
    <div class="test-section">
        <h2>üîç System Status Check</h2>
        <ul class="checklist">
            <li><span id="status-server" class="status-indicator status-pending"></span>Development server running</li>
            <li><span id="status-testapp" class="status-indicator status-pending"></span>TestApp.exe structure exists</li>
            <li><span id="status-browser" class="status-indicator status-pending"></span>Browser plugin supports app:// URLs</li>
            <li><span id="status-fileexplorer" class="status-indicator status-pending"></span>File Explorer recognizes .exe folders</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>üöÄ Core URL Flow Test</h2>
        
        <div class="flow-diagram">
            <div>user clicks: <code>TestApp.exe</code> folder</div>
            <div class="arrow">‚¨áÔ∏è</div>
            <div>browser opens: <code>app://PublishedApps/TestApp.exe</code></div>
            <div class="arrow">‚¨áÔ∏è</div>
            <div>browser converts to: <code>vfs://published-apps/TestApp.exe/index.html</code></div>
            <div class="arrow">‚¨áÔ∏è</div>
            <div>app loads in full-window mode (no navigation bar)</div>
        </div>
        
        <div class="test-grid">
            <button class="primary-btn" onclick="testDirectAppUrl()">
                üéØ Test app:// URL
            </button>
            <button class="secondary-btn" onclick="testDirectVfsUrl()">
                üìÅ Test vfs:// URL
            </button>
            <button class="secondary-btn" onclick="testUrlConversion()">
                üîÑ Test URL Conversion
            </button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üõ†Ô∏è Integration Tests</h2>
        <div class="test-grid">
            <button onclick="openFileExplorer()">
                üóÇÔ∏è File Explorer
            </button>
            <button onclick="openBuilderIDE()">
                ‚ö° Builder IDE
            </button>
            <button onclick="testPublishFlow()">
                üì¶ Test Publish Flow
            </button>
            <button onclick="validateExeRendering()">
                üëÅÔ∏è Validate .exe Rendering
            </button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìã Expected Results</h2>
        <div class="info-box">
            <strong>‚úÖ Success Criteria:</strong>
            <ul>
                <li>üéØ <code>app://PublishedApps/TestApp.exe</code> loads React app</li>
                <li>üñºÔ∏è Full-window mode (no browser navigation bar)</li>
                <li>‚ö° Interactive counter works (click to increment)</li>
                <li>üóÇÔ∏è .exe folders show with purple Settings icon in File Explorer</li>
                <li>üîó Double-clicking .exe folder opens with app:// URL</li>
            </ul>
        </div>
    </div>
    
    <div id="result" class="result" style="display: none;"></div>
    
    <div class="test-section">
        <h2>üîß System Info</h2>
        <p><strong>Current URL:</strong> <code id="currentUrl"></code></p>
        <p><strong>Base URL:</strong> <code id="baseUrl"></code></p>
        <p><strong>Timestamp:</strong> <code id="timestamp"></code></p>
    </div>

    <script>
        // Initialize system info
        function updateSystemInfo() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('baseUrl').textContent = window.location.origin;
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }
        
        updateSystemInfo();
        
        // Status checking functions
        function updateStatus(elementId, success, message = '') {
            const element = document.getElementById(elementId);
            element.className = 'status-indicator ' + (success ? 'status-success' : 'status-error');
            if (message && element.parentNode) {
                const textNode = element.parentNode.childNodes[1];
                if (textNode) textNode.textContent = textNode.textContent.split(' - ')[0] + (message ? ' - ' + message : '');
            }
        }
        
        // Check system status
        async function checkSystemStatus() {
            try {
                // Check if development server is running
                const response = await fetch(window.location.origin + '/prometheos/');
                updateStatus('status-server', response.ok, response.ok ? 'OK' : 'Failed');
                
                // Check if TestApp.exe structure exists
                try {
                    const testAppResponse = await fetch('/prometheos/shadow/published-apps/TestApp.exe/index.html');
                    updateStatus('status-testapp', testAppResponse.ok, testAppResponse.ok ? 'Found' : 'Missing');
                } catch (e) {
                    updateStatus('status-testapp', false, 'Missing');
                }
                
                // Check browser plugin (assuming it exists if server is running)
                updateStatus('status-browser', true, 'Available');
                
                // Check file explorer (assuming it exists if server is running)
                updateStatus('status-fileexplorer', true, 'Available');
                
            } catch (error) {
                updateStatus('status-server', false, 'Connection failed');
                console.error('Status check failed:', error);
            }
        }
        
        // Run status check on load
        checkSystemStatus();
        
        // Result display function
        function showResult(message, type = 'success') {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + type;
            resultDiv.innerHTML = message;
            
            // Auto-hide after 10 seconds for success messages
            if (type === 'success') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 10000);
            }
        }
        
        // Core test functions
        function testDirectAppUrl() {
            showResult('üîÑ Testing app:// URL... Opening in new window/tab', 'warning');
            
            const baseUrl = window.location.origin + '/prometheos/';
            const appUrl = baseUrl + '?appPath=app://PublishedApps/TestApp.exe';
            
            console.log('üéØ Opening app URL:', appUrl);
            window.open(appUrl, '_blank');
            
            setTimeout(() => {
                showResult(`
                    ‚úÖ <strong>App URL Test Launched!</strong><br>
                    <strong>URL:</strong> <code>${appUrl}</code><br><br>
                    <strong>Expected:</strong> React app with interactive counter in full-window mode<br>
                    <strong>Check:</strong> New window/tab should show no navigation bar
                `, 'success');
            }, 1000);
        }
        
        function testDirectVfsUrl() {
            showResult('üîÑ Testing vfs:// URL... Opening in new window/tab', 'warning');
            
            const baseUrl = window.location.origin + '/prometheos/';
            const vfsUrl = baseUrl + '?appPath=vfs://published-apps/TestApp.exe/index.html';
            
            console.log('üìÅ Opening VFS URL:', vfsUrl);
            window.open(vfsUrl, '_blank');
            
            setTimeout(() => {
                showResult(`
                    ‚úÖ <strong>VFS URL Test Launched!</strong><br>
                    <strong>URL:</strong> <code>${vfsUrl}</code><br><br>
                    <strong>Expected:</strong> Same React app (should be identical to app:// test)<br>
                    <strong>Check:</strong> Both URLs should show the same content
                `, 'success');
            }, 1000);
        }
        
        function testUrlConversion() {
            const appUrl = 'app://PublishedApps/TestApp.exe';
            const expectedVfsUrl = 'vfs://published-apps/TestApp.exe/index.html';
            
            // Simulate the getPublishedAppUrl function
            function getPublishedAppUrl(url) {
                const urlParts = url.substring(6); // Remove "app://"
                if (urlParts.startsWith("PublishedApps/")) {
                    const appName = urlParts.substring(14); // Remove "PublishedApps/"
                    return \`vfs://published-apps/\${appName}/index.html\`;
                }
                return url;
            }
            
            const convertedUrl = getPublishedAppUrl(appUrl);
            const isCorrect = convertedUrl === expectedVfsUrl;
            
            showResult(\`
                \${isCorrect ? '‚úÖ' : '‚ùå'} <strong>URL Conversion Test</strong><br>
                <strong>Input:</strong> <code>\${appUrl}</code><br>
                <strong>Expected:</strong> <code>\${expectedVfsUrl}</code><br>
                <strong>Actual:</strong> <code>\${convertedUrl}</code><br>
                <strong>Result:</strong> \${isCorrect ? 'PASS' : 'FAIL'}
            \`, isCorrect ? 'success' : 'error');
        }
        
        // Integration test functions
        function openFileExplorer() {
            showResult('üîÑ Opening File Explorer... Navigate to published-apps folder', 'warning');
            
            const baseUrl = window.location.origin + '/prometheos/';
            const explorerUrl = baseUrl + '?appPath=file:///src/plugins/apps/file-explorer/index.tsx';
            
            window.open(explorerUrl, '_blank');
            
            setTimeout(() => {
                showResult(\`
                    ‚úÖ <strong>File Explorer Opened!</strong><br>
                    <strong>Instructions:</strong><br>
                    1. Navigate to <code>published-apps</code> folder<br>
                    2. Look for <code>TestApp.exe</code> folder<br>
                    3. Verify it shows purple Settings icon<br>
                    4. Double-click to test opening
                \`, 'success');
            }, 1000);
        }
        
        function openBuilderIDE() {
            showResult('üîÑ Opening Builder IDE... Ready for app publishing', 'warning');
            
            const baseUrl = window.location.origin + '/prometheos/';
            const builderUrl = baseUrl + '?appPath=file:///src/plugins/apps/builder/index.tsx';
            
            window.open(builderUrl, '_blank');
            
            setTimeout(() => {
                showResult(\`
                    ‚úÖ <strong>Builder IDE Opened!</strong><br>
                    <strong>Instructions:</strong><br>
                    1. Open <code>MyReactApp.jsx</code> from shadow folder<br>
                    2. Click "Publish App" to create new .exe<br>
                    3. Check Published Apps folder for new .exe<br>
                    4. Test the new published app
                \`, 'success');
            }, 1000);
        }
        
        function testPublishFlow() {
            showResult(\`
                üì¶ <strong>Publish Flow Test Instructions</strong><br><br>
                <strong>Steps to test:</strong><br>
                1. Open Builder IDE (click button above)<br>
                2. Open <code>MyReactApp.jsx</code> from shadow folder<br>
                3. Click "Publish App" button<br>
                4. Wait for success message<br>
                5. Open File Explorer<br>
                6. Navigate to Published Apps folder<br>
                7. Find new <code>MyReactApp.exe</code> folder<br>
                8. Double-click to open as app:// URL<br><br>
                <strong>Expected:</strong> New published app works like TestApp.exe
            \`, 'warning');
        }
        
        function validateExeRendering() {
            showResult(\`
                üëÅÔ∏è <strong>.exe Folder Rendering Validation</strong><br><br>
                <strong>Test checklist:</strong><br>
                ‚úÖ .exe folders show purple Settings icon<br>
                ‚úÖ Double-clicking opens browser with app:// URL<br>
                ‚úÖ app:// URLs convert to vfs:// URLs<br>
                ‚úÖ Published apps load in full-window mode<br>
                ‚úÖ No navigation bar for published apps<br>
                ‚úÖ React components render correctly<br>
                ‚úÖ Interactive elements work<br><br>
                <strong>Action:</strong> Use File Explorer to verify visual rendering
            \`, 'warning');
        }
        
        // Auto-refresh system status every 30 seconds
        setInterval(checkSystemStatus, 30000);
        
        console.log('üéØ .exe Folder System Validation loaded');
        console.log('üìã Available test functions:', {
            testDirectAppUrl,
            testDirectVfsUrl,
            testUrlConversion,
            openFileExplorer,
            openBuilderIDE,
            testPublishFlow,
            validateExeRendering
        });
    </script>
</body>
</html>
